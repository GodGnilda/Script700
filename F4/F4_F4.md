# FINAL FANTASY IV のサウンドドライバ で ROM のデータを使用して音楽を演奏するスクリプト

## 概要
[改良版 SNESAPU.DLL](https://github.com/dgrfactory/spcplay) (v2.19.0 以降) で動作するスクリプトファイルです。  
サウンドドライバファンクションを利用して、ROM の音楽データや圧縮波形データ等を APU RAM に転送し音楽を演奏します。  
ROM に登録されている (波形番号) 順に圧縮波形データを転送します。

## ファイル
- FINAL FANTASY IV のサウンドドライバが転送された状態の SPC ファイルが必要です。  
スナップショットを保存せずそのまま演奏する場合は、ジングル類を演奏終了状態の SPC をお使いになることで、ノイズ発生を抑制することが可能です。
- スクリプトが使用可能なメモリの量が制限されていますので、以下のファイルを作成する必要があります。スクリプトのファイル名等は適宜変更してください。
  - **F4_BRRS_2400F_3721C.BIN**  
sfc ファイル $2400F - $3721C のデータ (圧縮波形データ)
  - **F4_SONGS_3721D_438B8.BIN**  
sfc ファイル $3721D - $438B8 のデータ (音楽データ)

## プレイヤーの設定など
- [SNES SPC700 Player](https://github.com/dgrfactory/spcplay)
  - SNES SPC700 Player を起動し、バージョンを確認します。  
  v2.19.0 以降のバージョンではない場合は https://github.com/dgrfactory/spcplay/releases から spcplay-x.xx.x.xxxx.zip (v2.19 以降) をダウンロードし SNES SPC700 Player を更新します。
- [黒猫SPC](https://kurohane.net/seisanbutu.html)
  - 演奏設定ウィンドウ 黒猫 タブで、**使用する SNESAPU** を **Sunburst** に設定します。
  - メインウィンドウで [改良版 SNESAPU.DLL](https://github.com/dgrfactory/spcplay) のバージョンを確認します。  
  v2.19.0 以降のバージョンではない場合は 黒猫SPC を終了し、 https://github.com/dgrfactory/spcplay/releases から snesapu-x.xx.x.xxxx.zip (v2.19 以降) をダウンロードし、黒猫SPC の SNESAPU Sunburst フォルダの DLL を上書きします。
  - 演奏設定ウィンドウ SNESAPU タブの **NoScript700** のチェックを**オフ**にし、スクリプトを有効にします。

## 使用方法
- [SNES SPC700 Player](https://github.com/dgrfactory/spcplay)
  - SPC とスクリプトのファイル名が同じ場合は、SPC ファイルを開きます。  
  スクリプトファイルが自動的に読み込まれ、指定した曲のテータを転送し演奏開始します。
  - SPC とスクリプトのファイル名が異なりスクリプトファイルが自動的に読み込まれない場合は、SPC ファイルを開いた後にスクリプトファイルをドラッグ & ドロップします。  
  スクリプトファイルが更新され、指定した曲のテータを転送し演奏開始します。演奏状態は初期化されます。
  - ブレークポイントコマンド `bp` を使用したスナップショット保存をご利用になれます。
- [黒猫SPC](https://kurohane.net/seisanbutu.html)
  - SPC とスクリプトのファイル名を同じにして、SPC ファイルを開きます。  
  スクリプトファイルが自動的に読み込まれ、指定した曲のテータを転送し演奏開始します。
  - ブレークポイントコマンド `bp` を使用したスナップショット保存はご利用になれません。

## 演奏開始直前のスナップショット保存
ブレークポイントを利用可能なプレイヤーのみ保存可能です。
- [SNES SPC700 Player](https://github.com/dgrfactory/spcplay)  
243 行の `bp` コマンドを有効にし、SPC 700 の PC レジスタの値が $089C で停止している状態であることを確認後に SPC ファイルを保存してください。

## 曲を変更する
17 行の即値を書き換えてください。

  |値|曲名|
  |--:|:--|
  |$01|オープニング|
  |$02|長い道のり|
  |$03|ファンファーレ 2|
  |$04|チョコボ|
  |$05|サンバ・デ・チョコボ|
  |$06|ドワーフの大地|
  |$07|最後の闘い|
  |$08|勝利のファンファーレ|
  |$09|街のテーマ|
  |$0A|少女リディア|
  |$0B|ゴルベーザ四天王とのバトル|
  |$0C|試練の山|
  |$0D|ファイナルファンタジー IV メインテーマ|
  |$0E|魔導船|
  |$0F|哀しみのテーマ 2 ?|
  |$10|宿屋|
  |$11|黒い甲冑ゴルベーザ|
  |$12|ギルバートのリュート|
  |$13|愛のテーマ|
  |$14|バロン王国|
  |$15|プレリュード|
  |$16|一方その頃|
  |$17|バブイルの塔|
  |$18|飛空艇|
  |$19|ゾットの塔|
  |$1A|バトル 2|
  |$1B|巨人のダンジョン|
  |$1C|幻獣の街|
  |$1D|ボムの指輪|
  |$1E|月の民|
  |$1F|驚嘆|
  |$20|キング・ジオットの城|
  |$21|パロム・ポロムのテーマ|
  |$22|踊る人形カルコブリーナ|
  |$23|脱出|
  |$24|親方シド|
  |$25|ダンジョン|
  |$26|踊り子|
  |$27|バトル 1|
  |$28|ダムシアン城|
  |$29|ファンファーレ 1|
  |$2A|哀しみのテーマ ?|
  |$2B|チョコボの森|
  |$2C|赤い翼 (ニューゲーム)|
  |$2D|疑惑のテーマ|
  |$2E|ファブール国|
  |$2F|パラディン|
  |$30|デブチョコボ登場|
  |$31|もう一つの月|
  |$32|トロイア国|
  |$33|ミシディア国|
  |$34|赤い翼 (月の地下渓谷)|
  |$35|エンディング・テーマ -1-|
  |$36|エンディング・テーマ -2-|
  |$37|エンディング・テーマ -3-|
  |$3E|飛空挺 (ダムシアン城) ?|
  |$3F|出港|
  |$43|落下|


## ライセンス
[MITライセンス](https://opensource.org/licenses/mit-license.php)

## 更新履歴
- 2021/10/12
  - 試作。

- 2021/10/13
  - 転送する圧縮波形データが一つの場合無限ループに陥る不具合を修正。
