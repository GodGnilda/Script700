# FINAL FANTASY IV 改造サウンドドライバ で音楽と圧縮波形のデータファイルを使用して音楽を演奏するスクリプト

## 概要
[改良版 SNESAPU.DLL](https://github.com/dgrfactory/spcplay) (v2.19.0 以降) で動作するスクリプトファイルです。  
サウンドドライバファンクションを利用して、音楽データや圧縮波形データを APU RAM に転送し音楽を演奏します。

## ファイル
- 以下のファイルを作成する必要があります。スクリプトのファイル名等は適宜変更してください。
  - **SONG.BIN**  
音楽データファイルです。  
[FINAL FANTASY IV 改造サウンドドライバ : 音楽シーケンスデータ生成ツール](https://gnilda.rosx.net/SPC/F4G/spcseq.html) で <del>**SPC ファイルを選択しない (テキスト出力)** にチェックを入れ、</del>出力されたテキストをヘキサエディタに貼り付けて保存します。
  - **BRR09.BIN**, **BRR10.BIN**, ...  
圧縮波形に関するファイルです。  
ラベル番号 *0* の波形データは波形番号 *9* に、*1* の波形データは *10* に登録されます。  
一つのラベルに複数のファイルを読み込む設定の場合はアドレス計算が不可能なため、先頭のファイルのみ登録されます。  
ファイルの構造は以下の通りです。

  |オフセット|データ|サイズ|
  |--:|:--|:--|
  |0|データサイズ (LE)|2 バイト|
  |2|ループポイントの位置 (LE)|2 バイト|
  |4|圧縮波形データ|9n バイト|
- スクリプト書き換え  
  - 18 行の即値を**転送する圧縮波形データの数**に書き換えます。  
  - ラベル番号 *25* の 25 バイトのデータを書き換えることで、データ転送時の圧縮波形番号 9 ～ 33 のピッチ微調整値 1 を変更可能です。

## 演奏開始直前のスナップショット保存 (ブレークポイントを利用可能なプレイヤーのみ)
- 199 行の `bp` コマンドを有効にし、SPC700 の PC レジスタの値が $05AE で停止している状態であることを確認後に SPC ファイルを保存してください。
  <details>
  <summary>以前のバージョンのブレークポイント</summary>

  |バージョン|ブレークポイント|
  |:----:|:----:|
  |20211122-0|$0544|
  |20211124-0|$0544|
  |20211224-0|$05AE|
  </details>

## ライセンス
[MITライセンス](https://opensource.org/licenses/mit-license.php)

## 更新履歴
- 2021/01/25 [F4G-0 20220124-0]
  - 対応バージョンのみ更新。

- 2021/12/24 [F4G-0 20211224-0]
  - bp コマンドのアドレス変更。

- 2021/11/26 [F4G-0 20211124-0]
  - コメント修正など。

- 2021/11/22 [F4G-0 20211122-0]
  - 試作。
