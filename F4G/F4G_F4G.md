# FINAL FANTASY IV 改造サウンドドライバ で ROM のデータを使用して音楽を演奏するスクリプト

## 概要
[改良版 SNESAPU.DLL](https://github.com/dgrfactory/spcplay) (v2.19.0 以降) で動作するスクリプトファイルです。  
サウンドドライバファンクションを利用して、ROM の音楽データや圧縮波形データ等を APU RAM に転送し音楽を演奏します。  
ROM に登録されている (波形番号) 順に圧縮波形データを転送します。

## ファイル
- スクリプトが使用可能なメモリの量が制限されていますので、以下のファイルを作成する必要があります。スクリプトのファイル名等は適宜変更してください。
  - **F4_BRRS_2400F_3721C.BIN**  
sfc ファイル $2400F - $3721C のデータ (圧縮波形データ)
  - **F4G_SONGS_3721D_438B8.BIN**  
sfc ファイル $3721D - $438B8 のデータ (音楽データ)

## 演奏開始直前のスナップショット保存 (ブレークポイントを利用可能なプレイヤーのみ)
- 240 行の `bp` コマンドを有効にし、SPC700 の PC レジスタの値が $04AA で停止している状態であることを確認後に SPC ファイルを保存してください。
  <details>
  <summary>以前のバージョンのブレークポイント</summary>

  |バージョン|ブレークポイント|
  |:----:|:----:|
  |20211122-0|$0544|
  |20211124-0|$0544|
  |20211224-0|$05AE|
  |20220124-0|$05AE|
  </details>

## 曲を変更する
17 行の即値を書き換えてください。

  |値|曲名|
  |--:|:--|
  |$01|オープニング|
  |$04|チョコボ|
  |$08|勝利のファンファーレ|
  |$09|街のテーマ|
  |$0A|少女リディア|
  |$0D|ファイナルファンタジー IV メインテーマ|
  |$0F|哀しみのテーマ 2 ?|
  |$10|宿屋|
  |$12|ギルバートのリュート|
  |$13|愛のテーマ|
  |$14|バロン王国|
  |$15|プレリュード|
  |$1A|バトル 2|
  |$1D|ボムの指輪|
  |$1F|驚嘆|
  |$23|脱出|
  |$25|ダンジョン|
  |$26|踊り子|
  |$27|バトル 1|
  |$28|ダムシアン城|
  |$29|ファンファーレ 1|
  |$2A|哀しみのテーマ ?|
  |$2B|チョコボの森|
  |$2C|赤い翼 (ニューゲーム)|
  |$2D|疑惑のテーマ|
  |$31|もう一つの月|
  |$33|ミシディア国|
  |$42|地震 (ミストの村)|
  |$44|地下に通じる滝|
  |$45|エコー設定のみ (地下水脈 : 初めてのセーブポイント)|

## ライセンス
[MITライセンス](https://opensource.org/licenses/mit-license.php)

## 更新履歴
- 2021/02/22 [F4G-0 20220222-0]
  - ブレークポイントのアドレスを更新。

- 2021/01/25 [F4G-0 20220124-0]
  - 対応バージョンのみ更新。

- 2021/12/24 [F4G-0 20211224-0]
  - bp コマンドのアドレス変更。

- 2021/11/26 [F4G-0 20211124-0]
  - 無意味なコマンドを削除。

- 2021/11/22 [F4G-0 20211122-0]
  - 無意味なコマンドを削除。
  - ブレークポイントのアドレスを更新。

- 2021/10/20 [F4G-0 20211020-0]
  - ブレークポイントのアドレスを更新。

- 2021/10/13 [F4G-0 20211001-0]
  - 転送する圧縮波形データが一つの場合無限ループに陥る不具合を修正。

- 2021/10/01 [F4G-0 20211001-0]
  - 試作。
