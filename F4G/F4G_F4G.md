# FINAL FANTASY IV 改造サウンドドライバ で ROM のデータを使用して音楽を演奏するスクリプト

## 概要
[改良版 SNESAPU.DLL](https://github.com/dgrfactory/spcplay) (v2.19.0 以降) で動作するスクリプトファイルです。  
サウンドドライバファンクションを利用して、ROM の音楽データや圧縮波形データ等を APU RAM に転送し音楽を演奏します。  
ROM に登録されている (波形番号) 順に圧縮波形データを転送します。

### 準備
- FINAL FANTASY IV の改造サウンドドライバが転送された状態の SPC ファイルが必要です。  
スナップショットを保存せずそのまま演奏する場合は、ジングル類を演奏終了状態の SPC をお使いになることで、ノイズ発生を抑制することが可能です。
- スクリプトが使用可能なメモリの量が制限されていますので、以下のファイルを作成する必要があります。スクリプトのファイル名等は適宜変更してください。
  - **F4_BRRS_2400F_3721C.BIN**  
sfc ファイル $2400F - $3721C のデータ (圧縮波形データ)
  - **F4G_SONGS_3721D_438B8.BIN**  
sfc ファイル $3721D - $438B8 のデータ (音楽データ)

### 使用方法
- [SNES SPC700 Player](https://github.com/dgrfactory/spcplay)
  - SPC とスクリプトのファイル名が同じ場合は、SPC ファイルを開きます。  
  スクリプトファイルが自動的に読み込まれ、指定した曲のテータを転送し演奏開始します。
  - SPC とスクリプトのファイル名が異なりスクリプトファイルが自動的に読み込まれない場合は、SPC ファイルを開いた後にスクリプトファイルをドラッグ & ドロップします。  
  スクリプトファイルが読み込まれ、指定した曲のテータを転送し演奏開始します。
- [黒猫SPC](https://kurohane.net/seisanbutu.html)
  - 演奏設定 SNESAPU タブの NoScript700 のチェックをオフにし、スクリプトを有効にします。
  - SPC とスクリプトのファイル名を同じにして、SPC ファイルを開きます。  
  スクリプトファイルが自動的に読み込まれ、指定した曲のテータを転送し演奏開始します。

### 演奏開始直前のスナップショット保存
ブレークポイントを利用可能なプレイヤーのみ保存可能です。
- [SNES SPC700 Player](https://github.com/dgrfactory/spcplay)  
243 行の `bp` コマンドを有効にし、SPC 700 の PC レジスタの値が $053C で停止している状態であることを確認後に SPC ファイルを保存してください。

### 曲を変更する
17 行の即値を書き換えてください。

  |値|曲名|
  |--:|:--|
  |$14|バロン王国|
  |$15|プレリュード|
  |$2C|赤い翼 (オープニング)|
  |$2D|疑惑のテーマ|
  |$31|もう一つの月|
  |$33|ミシディア国|

### ライセンス
[MITライセンス](https://opensource.org/licenses/mit-license.php)

### 更新履歴
- 2021/10/01
  - 試作。

- 2021/10/13
  - 転送する圧縮波形データが一つの場合無限ループに陥る不具合を修正。
